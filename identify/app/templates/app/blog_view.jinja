{% extends 'app/layout.jinja' %}
{% load static %}
{% block title %}
    –ü–µ—Ä–µ–≥–ª—è–¥
{% endblock %}

{% block content %}
    <div class="blog-view-title">
        {{ blog.topic }}
        {% if blog.author.is_staff %}
            <img style="width: 64px;height: 64px" src="{% static 'app/images/logo.png' %}" alt="suka">
        {% endif %}
    </div>
    <div class="blog-view-container">
        <div class="blog-view-item">
            ìÇÄ
            <br>
            <p>{{ blog.view }}</p>
        </div>
        <div class="blog-view-item">
            <img style="border: 1px {{ user.profile.text_color }} solid" src="{{ blog.image.url }}">
        </div>
        <div class="blog-view-item">
            <a id="like-button">‚ô°</a>
            <br>
            <p id="likes-count">{{ blog.like }}</p>
        </div>
    </div>
    <div class="blog-view-description-container">
        <div class="blog-view-description">
            {{ blog.text }}
        </div>
    </div>
        <div class="blog-view-author">
            –¢–µ–≥–∏:
            {% for tag in tags%}
                 <a href="{% url 'search_result' %}" id="searchLink">#{{ tag }}</a>
            {% endfor%}
        </div>
        <div class="blog-view-author">
            –ê–≤—Ç–æ—Ä Iden'—É - 
            <a href="{% url 'profile_view' user_id=blog.author.id %}">
                {{ blog.author.nickname }}
            </a>
            ({{ blog.created_at|date:"d.m.Y" }})
            {% if request.user == blog.author %}
            <a href="{% url 'blog_redaction' user_id=user.id blog_id=blog.id %}">
                (–†–µ–¥–∞–≥—É–≤–∞—Ç–∏)
            </a>
            {% endif %}
            {% if request.user.is_staff %}
            <br>
                <a href="{% url 'blog_break' user_id=user.id blog_id=blog.id %}">
                    (–ü–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª)
                </a>   
            {% endif %}
        </div>

    
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ —É–∂–µ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω –ª–∞–π–∫ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
        {% if request.user in blog.likers.all %}
            $('#like-button').html('<span style="text-decoration: underline;">‚ô°</span>');
        {% else %}
            $('#like-button').text('‚ô°');
        {% endif %}

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –ª–∞–π–∫–∞
        $('#like-button').click(function() {
            $.post("{% url 'like_blog' blog.id %}", {
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            }, function(data) {
                if (data.status === 'liked') {
                    $('#likes-count').text(data.likes);
                    $('#like-button').html('<span style="text-decoration:underline">‚ô°</span>');
                } else if (data.status === 'unliked') {
                    $('#likes-count').text(data.likes);
                    $('#like-button').text('‚ô°');
                }
            });
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    document.getElementById('searchInput').addEventListener('input', function () {
        const query = this.value; // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –ø–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è
        const searchLink = document.getElementById('searchLink');
        const baseUrl = "{% url 'search_result' %}"; // –ë–∞–∑–æ–≤–∏–π URL –¥–ª—è –ø–æ—à—É–∫—É
        searchLink.href = `${baseUrl}?query=${encodeURIComponent(query)}`; // –î–æ–¥–∞—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä query –¥–æ URL
    });

    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó –¥–ª—è —Ñ–æ—Ä–º–∏
    document.getElementById('searchForm').addEventListener('submit', function (event) {
        const query = document.getElementById('searchInput').value; // –û—Ç—Ä–∏–º—É—î–º–æ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –ø–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è
        if (!query.trim()) {
            event.preventDefault(); // –ó—É–ø–∏–Ω—è—î–º–æ –≤—ñ–¥–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º–∏, —è–∫—â–æ –ø–æ–ª–µ –ø–æ—Ä–æ–∂–Ω—î
            alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ—à—É–∫—É.');
        }
    });
</script>
{% endblock %}